<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Encuesta Laboral Construcción</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background-color: #fff8f0;
    }

    header {
      background-color: #556b2f;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 2rem;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }

    select, input[type="text"], input[type="number"], textarea {
      width: 100%;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 0.3rem;
    }

    .checkbox-group, .radio-group {
      margin-top: 0.5rem;
    }

    .checkbox-group label,
    .radio-group label {
      font-weight: normal;
      display: block;
      margin-left: 1rem;
    }

    button {
      background-color: #d63384;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      margin-top: 2rem;
      font-size: 1rem;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    .message {
      margin-top: 1rem;
      font-weight: bold;
      color: green;
    }

    @media (max-width: 600px) {
      main {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Diagnóstico sobre Necesidades y Expectativas Laborales en la Industria de la Construcción</h1>
    <p>Enfoque en Nuevas Generaciones</p>
  </header>
  <main>
    <div class="card">
      <form id="encuesta-form">
        <input type="hidden" name="timestamp" id="timestamp" />

        <label>Edad:</label>
        <select name="edad" required>
          <option value="">Seleccione</option>
          <option>Menos de 18 años</option>
          <option>18 a 24 años</option>
          <option>25 a 34 años</option>
          <option>35 a 44 años</option>
          <option>45 años o más</option>
        </select>

        <label>Sexo:</label>
        <div class="radio-group">
          <label><input type="radio" name="sexo" value="Femenino" required> Femenino</label>
          <label><input type="radio" name="sexo" value="Masculino" required> Masculino</label>
          <label><input type="radio" name="sexo" value="Prefiero no decir" required> Prefiero no decir</label>
        </div>

        <label>Indique su rol actual:</label>
        <select name="rol" id="rol" required>
          <option value="">Seleccione</option>
          <option>Empleador</option>
          <option>Colaborador</option>
          <option>Estudiante</option>
        </select>

        <!-- Empleador -->
        <div id="empleador-fields" class="hidden">
          <label>¿El sector está preparado para integrar jóvenes?</label>
          <select name="sector_preparado">
            <option value="">Seleccione</option>
            <option>Sí</option>
            <option>No</option>
            <option>Parcialmente</option>
          </select>

          <label>¿Qué perfil joven le resulta más difícil de incorporar?</label>
          <select name="perfil_dificil">
            <option value="">Seleccione</option>
            <option>Técnicos</option>
            <option>Profesionales universitarios</option>
            <option>Sin experiencia previa</option>
            <option>No tengo problema en incorporar jóvenes</option>
          </select>

          <label>¿Qué preparación considera más necesaria?</label>
          <select name="preparacion_necesaria">
            <option value="">Seleccione</option>
            <option>Habilidades técnicas y prácticas</option>
            <option>Conocimiento de normas y seguridad</option>
            <option>Habilidades sociales y liderazgo</option>
            <option>Manejo de tecnología y software</option>
          </select>

          <label>¿Qué está dispuesto a ofrecer?</label>
          <select name="ofrecimientos">
            <option value="">Seleccione</option>
            <option>Programas de prácticas o residencias</option>
            <option>Capacitaciones internas</option>
            <option>Planes de crecimiento profesional</option>
            <option>Sueldos competitivos</option>
            <option>Flexibilidad o adaptación</option>
          </select>
        </div>

        <!-- Colaborador -->
        <div id="colaborador-fields" class="hidden">
          <label>¿Los jóvenes están preparados?</label>
          <div class="radio-group">
            <label><input type="radio" name="jovenes_preparados" value="Sí"> Sí</label>
            <label><input type="radio" name="jovenes_preparados" value="No"> No</label>
            <label><input type="radio" name="jovenes_preparados" value="Parcialmente"> Parcialmente</label>
          </div>

          <label>Mayores retos observados:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="retos_observados" value="Poca resistencia al trabajo físico"> Poca resistencia al trabajo físico</label>
            <label><input type="checkbox" name="retos_observados" value="Falta de disciplina o compromiso"> Falta de disciplina o compromiso</label>
            <label><input type="checkbox" name="retos_observados" value="Expectativas salariales irreales"> Expectativas salariales irreales</label>
            <label><input type="checkbox" name="retos_observados" value="Falta de habilidades técnicas"> Falta de habilidades técnicas</label>
          </div>

          <label>Recomendaciones para jóvenes:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="recomendaciones_colaborador" value="Tomar cursos prácticos"> Tomar cursos prácticos</label>
            <label><input type="checkbox" name="recomendaciones_colaborador" value="Buscar experiencia desde temprano"> Buscar experiencia desde temprano</label>
            <label><input type="checkbox" name="recomendaciones_colaborador" value="Ser constante y responsable"> Ser constante y responsable</label>
            <label><input type="checkbox" name="recomendaciones_colaborador" value="Adaptarse a los cambios"> Adaptarse a los cambios</label>
          </div>
        </div>

        <!-- Estudiante -->
        <div id="estudiante-fields" class="hidden">
          <label>Interés en el sector:</label>
          <div class="radio-group">
            <label><input type="radio" name="interes_en_sector" value="Muy interesado"> Muy interesado</label>
            <label><input type="radio" name="interes_en_sector" value="Interesado"> Interesado</label>
            <label><input type="radio" name="interes_en_sector" value="Poco interesado"> Poco interesado</label>
            <label><input type="radio" name="interes_en_sector" value="No me interesa"> No me interesa</label>
          </div>

          <label>Factores importantes (hasta 3):</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="factores_importantes" value="Sueldo y prestaciones"> Sueldo y prestaciones</label>
            <label><input type="checkbox" name="factores_importantes" value="Estabilidad laboral"> Estabilidad laboral</label>
            <label><input type="checkbox" name="factores_importantes" value="Posibilidades de crecimiento"> Posibilidades de crecimiento</label>
            <label><input type="checkbox" name="factores_importantes" value="Impacto en la sociedad"> Impacto en la sociedad</label>
            <label><input type="checkbox" name="factores_importantes" value="Innovación tecnológica"> Innovación tecnológica</label>
            <label><input type="checkbox" name="factores_importantes" value="Ambiente laboral positivo"> Ambiente laboral positivo</label>
            <label><input type="checkbox" name="factores_importantes" value="Capacitación y desarrollo"> Capacitación y desarrollo</label>
          </div>

          <label>Conocimientos por fortalecer:</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="conocimientos_por_fortalecer" value="Habilidades técnicas"> Habilidades técnicas</label>
            <label><input type="checkbox" name="conocimientos_por_fortalecer" value="Práctica en campo"> Práctica en campo</label>
            <label><input type="checkbox" name="conocimientos_por_fortalecer" value="Seguridad y normas laborales"> Seguridad y normas laborales</label>
            <label><input type="checkbox" name="conocimientos_por_fortalecer" value="Liderazgo y trabajo en equipo"> Liderazgo y trabajo en equipo</label>
            <label><input type="checkbox" name="conocimientos_por_fortalecer" value="Uso de software"> Uso de software</label>
          </div>

          <label>¿Has tenido experiencia laboral?</label>
          <select name="experiencia_laboral">
            <option value="">Seleccione</option>
            <option>Sí</option>
            <option>No</option>
            <option>Actualmente en curso</option>
          </select>

          <label>¿Qué apoyo esperas recibir?</label>
          <div class="checkbox-group">
            <label><input type="checkbox" name="apoyo_esperado" value="Capacitación inicial"> Capacitación inicial</label>
            <label><input type="checkbox" name="apoyo_esperado" value="Mentor en obra"> Mentor en obra</label>
            <label><input type="checkbox" name="apoyo_esperado" value="Buen ambiente de trabajo"> Buen ambiente de trabajo</label>
            <label><input type="checkbox" name="apoyo_esperado" value="Oportunidades de crecimiento"> Oportunidades de crecimiento</label>
            <label><input type="checkbox" name="apoyo_esperado" value="Horarios compatibles"> Horarios compatibles</label>
          </div>
        </div>

        <!-- Común -->
        <label>¿Qué acciones considera necesarias?</label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="acciones_mejora" value="Mayor vinculación con escuelas"> Mayor vinculación con escuelas</label>
          <label><input type="checkbox" name="acciones_mejora" value="Programas de prácticas remuneradas"> Programas de prácticas remuneradas</label>
          <label><input type="checkbox" name="acciones_mejora" value="Mejores condiciones laborales"> Mejores condiciones laborales</label>
          <label><input type="checkbox" name="acciones_mejora" value="Inclusión de mujeres y diversidad"> Inclusión de mujeres y diversidad</label>
          <label><input type="checkbox" name="acciones_mejora" value="Campañas de difusión"> Campañas de difusión</label>
          <label><input type="checkbox" name="acciones_mejora" value="Innovación tecnológica en el trabajo"> Innovación tecnológica en el trabajo</label>
        </div>

        <label>Comentarios finales (opcional):</label>
        <textarea name="comentarios" rows="4"></textarea>

        <button type="submit">Enviar encuesta</button>
        <div class="message" id="mensaje-envio"></div>
      </form>
    </div>
  </main>

  <script>
    document.getElementById("timestamp").value = new Date().toISOString();

    const form = document.getElementById("encuesta-form");
    const mensaje = document.getElementById("mensaje-envio");
    const rolSelect = document.getElementById("rol");

    const secciones = {
      Empleador: document.getElementById("empleador-fields"),
      Colaborador: document.getElementById("colaborador-fields"),
      Estudiante: document.getElementById("estudiante-fields")
    };

    rolSelect.addEventListener("change", () => {
      Object.values(secciones).forEach(div => div.classList.add("hidden"));
      const selected = rolSelect.value;
      if (secciones[selected]) {
        secciones[selected].classList.remove("hidden");
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);

      // Agrupar checkboxes múltiples con mismo name
      const checkboxNames = [
        "retos_observados", "recomendaciones_colaborador", "factores_importantes",
        "conocimientos_por_fortalecer", "apoyo_esperado", "acciones_mejora"
      ];

      checkboxNames.forEach(name => {
        const values = [...form.querySelectorAll(`input[name="${name}"]:checked`)].map(i => i.value);
        formData.set(name, values.join(", "));
      });

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbxbPf16suW7mq8fCpv2bwCRgf35VZ-2PQTB634wroAS8lWmbthn8uDO6R9KJK85dX76/exec", {
          method: "POST",
          body: formData
        });
        const result = await response.json();
        if (result.success) {
          mensaje.textContent = "✅ Datos enviados correctamente 🎉";
          form.reset();
          document.getElementById("timestamp").value = new Date().toISOString();
          Object.values(secciones).forEach(div => div.classList.add("hidden"));
          window.scrollTo({ top: 0, behavior: "smooth" });
          setTimeout(() => mensaje.textContent = "", 5000);
        } else {
          mensaje.textContent = "❌ Error al enviar datos.";
        }
      } catch (error) {
        console.error(error);
        mensaje.textContent = "❌ Error de red o servidor.";
      }
    });
  </script>
</body>
</html>
